<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>2019年电赛摸鱼记录 | 竹子的大结界</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta name="description" content="首先先看看这个蛋疼的试题…呜呜呜1234567891011121314151617181920212223242526272829303132333435363738394041424344454647482019 年华北电力大学第十三届大学生电子设计竞赛试题参赛注意事项（1） 竞赛时间：4 月 20 日 8：00--4 月 20 日 18：00（电路测试时间：4 月 21 日 8：00 开始）。">
<meta property="og:type" content="article">
<meta property="og:title" content="2019年电赛摸鱼记录">
<meta property="og:url" content="http://yizhuzi.github.io/2019/04/20/2019年电赛摸鱼记录/index.html">
<meta property="og:site_name" content="竹子的大结界">
<meta property="og:description" content="首先先看看这个蛋疼的试题…呜呜呜1234567891011121314151617181920212223242526272829303132333435363738394041424344454647482019 年华北电力大学第十三届大学生电子设计竞赛试题参赛注意事项（1） 竞赛时间：4 月 20 日 8：00--4 月 20 日 18：00（电路测试时间：4 月 21 日 8：00 开始）。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-04-21T08:32:53.561Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2019年电赛摸鱼记录">
<meta name="twitter:description" content="首先先看看这个蛋疼的试题…呜呜呜1234567891011121314151617181920212223242526272829303132333435363738394041424344454647482019 年华北电力大学第十三届大学生电子设计竞赛试题参赛注意事项（1） 竞赛时间：4 月 20 日 8：00--4 月 20 日 18：00（电路测试时间：4 月 21 日 8：00 开始）。">
  
    <link rel="alternate" href="/atom.xml" title="竹子的大结界" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/title.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlight.css">
  <script>
  let antiquityStorage = window.sessionStorage.getItem('antiquitySessionStorage');
  if (antiquityStorage == '' || antiquityStorage == null) {
    var antiquityLoader = '<div id="loaderbox"><div class="loader"><div class="load-roll"><div class="load-top"></div><div class="load-right"></div><div class="load-bottom"></div></div></div></div>';
    document.write(antiquityLoader);
    document.body.style.overflow = 'hidden'
  }
  </script>
</head>
</html>
<body>
  <div id="fullpage" class="mobile-nav-right">
    
      <div id="wrapper" style="background-image: url(/images/bgdef.jpg)" title="很普通的一张背景啦">
    
    
      <header id="header">
  <div id="nav-toggle" class="nav-toggle"></div>
  <div class="head-box global-width">
    <nav class="nav-box nav-right">
      
        <a class="nav-item" href="/" title>主页</a>
      
        <a class="nav-item" href="/archives" title>归档</a>
      
        <a class="nav-item" href="/categories" title>分类</a>
      
        <a class="nav-item" href="/tags" title>标签</a>
      
        <a class="nav-item" href="/about" title>关于</a>
      
        <a class="nav-item" href="/daiqian" title>贴吧代签</a>
      
    </nav>
  </div>
</header>
      <div id="middlecontent" title class="global-width sidebar-right">
        <section id="main"><article id="repo-2019年电赛摸鱼记录" class="article global-container article-type-repo" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 class="article-title" itemprop="name">
      2019年电赛摸鱼记录
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/04/20/2019年电赛摸鱼记录/" class="article-date">
  <time datetime="2019-04-20T11:28:38.000Z" itemprop="datePublished">2019-04-20</time>
</a>
    
    
  </div>
  
    <span id="busuanzi_container_page_pv">
      本文总阅读量<span id="busuanzi_value_page_pv"></span>次
    </span>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <p>首先先看看这个蛋疼的试题…呜呜呜<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">2019 年华北电力大学第十三届大学生电子设计竞赛试题</span><br><span class="line">参赛注意事项</span><br><span class="line">（1） 竞赛时间：4 月 20 日 8：00--4 月 20 日 18：00（电路测试时间：4 月 21 日 8：00 开始）。</span><br><span class="line">（2） 竞赛试题包括两部分内容：1、设计方案阐述；2、电路设计与制作。其中电路设计部分</span><br><span class="line">要求完成实物制作并在规定时间进行测试完成测试表，需给出设计方案分析，电路图及</span><br><span class="line">参数。</span><br><span class="line">（3） 每队不超 3 人，开赛后不得中途更换队员，参赛者需携带个人学生证随时备查。</span><br><span class="line">（4） 竞赛期间，可使用各种图书资料和网络资源，但不得在学校指定竞赛场地外进行设计制</span><br><span class="line">作，不得以任何方式与他人交流，包括教师在内的非参赛队员必须回避，对违纪参赛队</span><br><span class="line">取消评审资格。</span><br><span class="line">一、任务</span><br><span class="line">运算放大器（简称“运放”）是具有很高放大倍数的电路单元。在实际电路中，通常结</span><br><span class="line">合反馈网络共同组成某种功能模块。运放不仅可以构成放大电路，还可以实现滤波、加减</span><br><span class="line">运算、微分积分运算等。</span><br><span class="line">二、要求</span><br><span class="line">使用单片机产生频率为 40kHz 占空比可调的 PWM 信号，经过低通滤波器后得到特定</span><br><span class="line">的信号作为输入信号，使用一片运算放大器 OPA2333 及其它元器件设计积分、微分电路，</span><br><span class="line">实现如下图框图所示功能。</span><br><span class="line">单片机产生</span><br><span class="line">PWM 低通滤波</span><br><span class="line">积分电路</span><br><span class="line">微分电路</span><br><span class="line">输入信号</span><br><span class="line">输出信号</span><br><span class="line">图 1 电路框图</span><br><span class="line">具体要求：</span><br><span class="line">1、单片机输出 PWM 信号，频率 80kHz，占空比可变；（10 分）</span><br><span class="line">2、设计制作低通滤波器（2-4 阶），通过单片机控制可用按键切换两种输出模式：</span><br><span class="line">a.输出 125Hz 方波，幅值可控，其平均值（偏移）为 1.8V，峰峰值为 1.4V；（15 分）</span><br><span class="line">b.输出 125Hz 三角波，幅值可控，其平均值（偏移）为 1.8V，峰峰值为 1.4V；（15 分）</span><br><span class="line">（以上内容可用信号发生器或者配置好的开发板进行测试，如此则该部分内容不得分）</span><br><span class="line">3、利用 OPA2333 设计电路分别对以上方波和三角波进行积分，输出无明显失真，写出方波和</span><br><span class="line">三角波电压对时间的积分公式，将自己设计的参数代入计算；（20 分）</span><br><span class="line">4、利用 OPA2333 设计电路分别对以上方波和三角波进行微分，输出无明显失真，写出方波和</span><br><span class="line">三角波电压对时间的微分公式，将自己设计的参数代入计算；（20 分）</span><br><span class="line">5、电路制作。（10 分）</span><br><span class="line">三、说明</span><br><span class="line">1、设备器件清单</span><br><span class="line">（1） 数字存储示波器、函数信号发生器、数字万用表、单路直流稳压电源（5V/1A）。</span><br><span class="line">（2） 多功能面包板、万用板，恒温烙铁、斜口钳、镊子、剥线钳等。</span><br><span class="line">（3） 元器件清单（按需取用，不得多取浪费。）</span><br><span class="line">种类 内容</span><br><span class="line">芯片 OPA2333*1(已焊接)</span><br><span class="line">电阻 10，100，1k，10k，100k，1M</span><br><span class="line">电容 1nF，10nF，100nF，1uF</span><br><span class="line">电位器 1k，10k，100k</span><br><span class="line">其它 单芯铜导线，杜邦线，排针，跳线帽</span><br><span class="line">2、电路要预留出明确的测试点，芯片损坏如需更换扣 10 分。</span><br></pre></td></tr></table></figure></p>
<p>emmmm既然已经回宿舍了，345是搞不了了…看看1、2能做点什么文章…<br>想了想还是搞一个单片机同时输出“80kHz可调占空比”&amp;&amp;“125Hz 方波，幅值可控，其平均值（偏移）为 1.8V，峰峰值为 1.4V”&amp;&amp;“125Hz 三角波”<br>控制的话暂定按键中断吧。。。宿舍木得示波器。。。输出只能看脸了<br>看了眼按键对应的接口。。。<br>“WAKE UP”—PA0<br>“KEY0”     —PC5<br>“KEY1”     —PA15<br>emmmm先声明一个IO口。。。“void GPIO_Init(GPIO_TypeDef<em> GPIOx, GPIO_InitTypeDef</em> GPIO_InitStruct)”<br>。。。<br>敲里吗。。。。<br>算了算了不管中断，打算搞个骚操作。。。<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">while(t_d--)</span><br><span class="line">&#123;</span><br><span class="line">	t=KEY_Scan(0);		//得到键值</span><br><span class="line">	switch(t)</span><br><span class="line">	&#123;				 </span><br><span class="line">		case KEY0_PRES:</span><br><span class="line">			ns=1;</span><br><span class="line">			break;</span><br><span class="line">		case KEY1_PRES:</span><br><span class="line">			ns=2;</span><br><span class="line">			break;</span><br><span class="line">		default:</span><br><span class="line">			delay_ms(10);	</span><br><span class="line">	&#125; </span><br><span class="line">&#125;		//三秒内如果按下按键0/1，则输出其它波形</span><br></pre></td></tr></table></figure></p>
<p>嗯。。。这个就是一个小聪明。。。或者说骚操作吧，没时间研究中断了。。。<br>再看看DAC电压输出。。。<br>翻了翻初始化函数与设置函数<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//DAC通道1输出初始化</span><br><span class="line">void Dac1_Init(void)</span><br><span class="line">&#123;</span><br><span class="line">  </span><br><span class="line">	GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">	DAC_InitTypeDef DAC_InitType;</span><br><span class="line"></span><br><span class="line">	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE );	  //使能PORTA通道时钟</span><br><span class="line">   	RCC_APB1PeriphClockCmd(RCC_APB1Periph_DAC, ENABLE );	  //使能DAC通道时钟 </span><br><span class="line"></span><br><span class="line">	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_4;				 // 端口配置  可以看出是4串口</span><br><span class="line"> 	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AIN; 		 //模拟输入</span><br><span class="line"> 	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line"> 	GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line">	GPIO_SetBits(GPIOA,GPIO_Pin_4)	;//PA.4·····</span><br><span class="line">	DAC_InitType.DAC_Trigger=DAC_Trigger_None;	//不使用触发功能 TEN1=0</span><br><span class="line">	DAC_InitType.DAC_WaveGeneration=DAC_WaveGeneration_None;//不使用波形发生·······波形发生这里。。。再看看吧，感觉有点意思</span><br><span class="line">	DAC_InitType.DAC_LFSRUnmask_TriangleAmplitude=DAC_LFSRUnmask_Bit0;//屏蔽、幅值设置</span><br><span class="line">	DAC_InitType.DAC_OutputBuffer=DAC_OutputBuffer_Disable ;	//DAC1输出缓存关闭 BOFF1=1</span><br><span class="line">    DAC_Init(DAC_Channel_1,&amp;DAC_InitType);	 //初始化DAC通道1</span><br><span class="line">	DAC_Cmd(DAC_Channel_1, ENABLE);  //使能DAC1</span><br><span class="line">    DAC_SetChannel1Data(DAC_Align_12b_R, 0);  //12位右对齐数据格式设置DAC值</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">//设置通道1输出电压</span><br><span class="line">//vol:0~3300,代表0~3.3V</span><br><span class="line">void Dac1_Set_Vol(u16 vol)</span><br><span class="line">&#123;</span><br><span class="line">	float temp=vol;</span><br><span class="line">	temp/=1000;</span><br><span class="line">	temp=temp*4096/3.3;</span><br><span class="line">	DAC_SetChannel1Data(DAC_Align_12b_R,temp);//12位右对齐数据格式设置DAC值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>·····Two hours later…<br>我。。。刚刚经历了什么。。。<br>DAC方面。。。。暂时从dac.c里面凑了个这个<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">void Dac1_Init_(void)</span><br><span class="line">&#123;</span><br><span class="line">  </span><br><span class="line">	GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">	DAC_InitTypeDef DAC_InitType;</span><br><span class="line"></span><br><span class="line">	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE );	  //使能PORTA通道时钟</span><br><span class="line">   	RCC_APB1PeriphClockCmd(RCC_APB1Periph_DAC, ENABLE );	  //使能DAC通道时钟 </span><br><span class="line"></span><br><span class="line">	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_4;				 // 端口配置。4口</span><br><span class="line"> 	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AIN; 		 //模拟输入</span><br><span class="line"> 	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line"> 	GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line">	GPIO_SetBits(GPIOA,GPIO_Pin_4)	;//PA.4 输出高</span><br><span class="line">					</span><br><span class="line">	DAC_InitType.DAC_Trigger=DAC_Trigger_None;	//不使用触发功能 TEN1=0</span><br><span class="line">	DAC_InitType.DAC_WaveGeneration=DAC_WaveGeneration_None;//不使用波形发生</span><br><span class="line">	DAC_InitType.DAC_LFSRUnmask_TriangleAmplitude=DAC_LFSRUnmask_Bit0;//屏蔽、幅值设置</span><br><span class="line">	DAC_InitType.DAC_OutputBuffer=DAC_OutputBuffer_Disable ;	//DAC1输出缓存关闭 BOFF1=1</span><br><span class="line">    DAC_Init(DAC_Channel_1,&amp;DAC_InitType);	 //初始化DAC通道1</span><br><span class="line">	DAC_Cmd(DAC_Channel_1, ENABLE);  //使能DAC1</span><br><span class="line">    DAC_SetChannel1Data(DAC_Align_12b_R, 0);  //12位右对齐数据格式设置DAC值</span><br><span class="line">&#125;</span><br><span class="line">s</span><br><span class="line">//设置通道1输出电压</span><br><span class="line">//vol:0~3300,代表0~3.3V</span><br><span class="line">void Dac1_Set_Vol_(u16 vol)</span><br><span class="line">&#123;</span><br><span class="line">	float temp=vol;</span><br><span class="line">	temp/=1000;</span><br><span class="line">	temp=temp*4096/3.3;</span><br><span class="line">	DAC_SetChannel1Data(DAC_Align_12b_R,temp);//12位右对齐数据格式设置DAC值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>又从CSDN上面找到了<a href="https://blog.csdn.net/ybhuangfugui/article/details/51373356" target="_blank" rel="noopener">https://blog.csdn.net/ybhuangfugui/article/details/51373356</a> 这篇文章。。。感觉参考价值比较大，可惜公众号上面木得这个例程，有点可惜<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">void triconfig(void)</span><br><span class="line">&#123;</span><br><span class="line">DAC_InitTypeDef  DAC_InitStructure;</span><br><span class="line">TIM_TimeBaseInitTypeDef  TIM_TimeBaseStructure;</span><br><span class="line">GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">/* 使能AHB时钟 */</span><br><span class="line">RCC_AHBPeriphClockCmd(RCC_APB2Periph_GPIOA | RCC_APB2Periph_GPIOB | </span><br><span class="line">                        RCC_APB2Periph_GPIOC | RCC_APB2Periph_GPIOD | RCC_APB2Periph_GPIOE | RCC_APB2Periph_GPIOF | RCC_APB2Periph_USART1, ENABLE);</span><br><span class="line">/* 使能APB2时钟 */</span><br><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1, ENABLE);</span><br><span class="line">/* 使能APB1时钟 */</span><br><span class="line">GPIO_InitStructure.GPIO_Pin = GPIO_Pin_4 | GPIO_Pin_5;</span><br><span class="line">GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AIN;                       //模拟模式</span><br><span class="line">GPIO_Init(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line">/* DA1配置 */</span><br><span class="line">DAC_InitStructure.DAC_Trigger = DAC_Trigger_T2_TRGO;              //软件触发DA转换</span><br><span class="line">DAC_InitStructure.DAC_WaveGeneration = DAC_WaveGeneration_Triangle;    //不产生波形</span><br><span class="line">DAC_InitStructure.DAC_LFSRUnmask_TriangleAmplitude = DAC_TriangleAmplitude_1;</span><br><span class="line">DAC_InitStructure.DAC_OutputBuffer = DAC_OutputBuffer_Enable;      //使能输出缓存</span><br><span class="line">DAC_Init(DAC_Channel_1, &amp;DAC_InitStructure);</span><br><span class="line">DAC_InitStructure.DAC_LFSRUnmask_TriangleAmplitude = DAC_TriangleAmplitude_1023;</span><br><span class="line">DAC_Init(DAC_Channel_2, &amp;DAC_InitStructure);</span><br><span class="line">DAC_Cmd(DAC_Channel_1, ENABLE);   </span><br><span class="line">DAC_Cmd(DAC_Channel_2, ENABLE); </span><br><span class="line">DAC_SetDualChannelData(DAC_Align_12b_R, 0x100, 0x100);</span><br><span class="line">/* TIM2时基单元配置 */</span><br><span class="line">TIM_TimeBaseStructInit (&amp;TIM_TimeBaseStructure );</span><br><span class="line">TIM_TimeBaseStructure.TIM_Prescaler = 0x0F;        //预分频值</span><br><span class="line">TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_Up;        //向上计数模式</span><br><span class="line">TIM_TimeBaseStructure.TIM_Period = 0x0F;             //定时周期(自动从装载寄存器ARR的值)</span><br><span class="line">TIM_TimeBaseStructure.TIM_ClockDivision = 0x00;            //时钟分频因子</span><br><span class="line">TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_Up ;</span><br><span class="line">TIM_TimeBaseInit(TIM6, &amp;TIM_TimeBaseStructure);</span><br><span class="line">/* 使能预分频值 */</span><br><span class="line">TIM_SelectOutputTrigger(TIM2,TIM_TRGOSource_Update );       </span><br><span class="line">TIM_Cmd(TIM2,ENABLE);</span><br><span class="line">&#125;</span><br><span class="line">void DAC1_OutTriangle(uint16_t DAC_BaseData,uint16_t DAC_TriangleAmplitude_x,uint16_t Frequency)</span><br><span class="line">&#123;</span><br><span class="line">	DAC_InitTypeDef  DAC_InitStructure;</span><br><span class="line">	TIM_TimeBaseInitTypeDef TIM_TimeBaseStructure;	</span><br><span class="line">uint16_t amplitude_index;</span><br><span class="line">uint16_t amplitude_x;</span><br><span class="line">uint16_t tim_presc;</span><br><span class="line">/* 1.计算数值*/</span><br><span class="line">amplitude_index = ( (DAC_TriangleAmplitude_x &gt;&gt; 8) &amp; 0x000F) + 1;</span><br><span class="line">amplitude_x = pow(2, amplitude_index) ;</span><br><span class="line">tim_presc = SystemCoreClock / Frequency / amplitude_x / 4;</span><br><span class="line">//计算TIM分频值</span><br><span class="line">DAC_InitStructure.DAC_Trigger = DAC_Trigger_T2_TRGO;  //IIM2触发DA转换</span><br><span class="line">DAC_InitStructure.DAC_WaveGeneration = DAC_WaveGeneration_Triangle;//三角波形</span><br><span class="line">//设置振幅值</span><br><span class="line">DAC_InitStructure.DAC_LFSRUnmask_TriangleAmplitude = DAC_TriangleAmplitude_x;</span><br><span class="line">DAC_InitStructure.DAC_OutputBuffer=DAC_OutputBuffer_Enable;  //11使能输出缓存</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>？？？这都啥玩意。。。一脸黑人问号。。。<br>主程目前搞得。。。唉玄学代码<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">int main(void)</span><br><span class="line"> &#123;	</span><br><span class="line">	u8 t=0;	  </span><br><span class="line">	u8 ns=0;</span><br><span class="line">	u8 t_d=1;</span><br><span class="line"> 	//LCD_Init();</span><br><span class="line">	delay_init();	    	 //延时函数初始化	  </span><br><span class="line">	LED_Init();		  	 	//初始化与LED连接的硬件接口</span><br><span class="line">	KEY_Init();          	//初始化与按键连接的硬件接口</span><br><span class="line">	LED0=0;					//点亮LED</span><br><span class="line">  Dac1_Init_(); //PA4作为方形波输出接口</span><br><span class="line">	triconfig();</span><br><span class="line">	while(t_d)</span><br><span class="line">	&#123;</span><br><span class="line">		t=KEY_Scan(0);		//得到键值</span><br><span class="line">		switch(t)</span><br><span class="line">		&#123;				 </span><br><span class="line">			case KEY0_PRES:</span><br><span class="line">				ns = 1;</span><br><span class="line">			  t_d = 0;</span><br><span class="line">				break;</span><br><span class="line">			case KEY1_PRES:</span><br><span class="line">				ns = 2;</span><br><span class="line">			t_d = 0;</span><br><span class="line">				break;</span><br><span class="line">			default:</span><br><span class="line">				delay_ms(10);	</span><br><span class="line">		&#125; </span><br><span class="line">	&#125;		//三秒内如果按下按键0/1，则输出其它波形*/</span><br><span class="line">	while(1)</span><br><span class="line">	&#123;</span><br><span class="line">		ns=2;</span><br><span class="line">		if(ns==1)</span><br><span class="line">		&#123;</span><br><span class="line">			//LCD_Clear(0x001F);</span><br><span class="line">	//	LCD_ShowString(30,70,200,16,16,&quot;NOW:square wave&quot;);</span><br><span class="line">		while(1)&#123;</span><br><span class="line">			Dac1_Set_Vol_(2.5);</span><br><span class="line">			delay_ms(4);</span><br><span class="line">			Dac1_Set_Vol_(1.1);</span><br><span class="line">			delay_ms(4);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	else</span><br><span class="line">		&#123;</span><br><span class="line">		//LCD_Clear(0x7FFF);</span><br><span class="line">		//LCD_ShowString(30,70,200,16,16,&quot;NOW:triangle wave&quot;);</span><br><span class="line">		DAC1_OutTriangle(0, DAC_TriangleAmplitude_2047, 100);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>等过阵子安稳下来就好好学习一下单片机了。。。明天顺便去拿下快递研究下那个神奇的空气传感器？？？</p>

      
    </div>
    
      <footer class="article-footer">
        完
      </footer>
    
  </div>
  
    
<nav id="article-nav">
  <div class="article-nav-block">
    
      <a href="/2019/04/21/基于单片机的宿舍二氧化碳浓度测量/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption"></strong>
        <div class="article-nav-title">
          
            基于单片机的宿舍二氧化碳浓度测量
          
        </div>
      </a>
    
  </div>
  <div class="article-nav-block">
    
      <a href="/2019/04/08/STM32_1/" id="article-nav-older" class="article-nav-link-wrap">
        <div class="article-nav-title">竹子のSTM32苦逼笔记&lt;一&gt; TFTLCD显示篇</div>
        <strong class="article-nav-caption"></strong>
      </a>
    
  </div>
</nav>

    
<div id="gitmentContainer"></div>
<link rel="stylesheet" href="https://jjeejj.github.io/css/gitment.css">
<script src="https://jjeejj.github.io/js/gitment.js"></script>gitment.browser.js">
<script>
var gitment = new Gitment({
  owner: 'yizhuzi',
  repo: 'https://yizhuzi.github.io/',
  oauth: {
    client_id: 'df1d4d597bf3deb1f4e2',
    client_secret: '760883a0c751b28a2a33d2689217c3bd16b85680',
  },
})
gitment.render('gitmentContainer')
</script>

  
  
</article>
</section>
        <aside id="sidebar">
  
    <div class="widget-box">
  <div class="avatar-box">
    <img class="avatar" src="/images/avatar.png" title="www说起来QQ是243285773来着，有事QQ找我www">
    <h3 class="avatar-name">
      
        竹子
      
    </h3>
    <p class="avatar-slogan">
      特别耐撕的电气狗，顺便打打手游看看番。
    </p>
  </div>
</div>


  
    

  
    

  
    
  
    
  <div class="widget-box">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">7</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/05/21/小白竹的树莓派练习笔记-1/">小白竹的树莓派练习笔记&lt;1&gt;</a>
          </li>
        
          <li>
            <a href="/2019/05/03/matlab初体验/">基于matlab的电磁场求解</a>
          </li>
        
          <li>
            <a href="/2019/04/22/电路复习记录/">电路的复习总结</a>
          </li>
        
          <li>
            <a href="/2019/04/21/基于单片机的宿舍二氧化碳浓度测量/">基于单片机的宿舍二氧化碳浓度测量</a>
          </li>
        
          <li>
            <a href="/2019/04/20/2019年电赛摸鱼记录/">2019年电赛摸鱼记录</a>
          </li>
        
      </ul>
    </div>
  </div>

  
      <div class="widget-box">
    <h3 class="widget-title">友链</h3>
    <div class="widget">
      
        <a style="display: block;" href="https://keeptpa.cn/" title target="_blank">保持</a>
      
        <a style="display: block;" href="https://yuusora.com/" title target="_blank">太空</a>
      
        <a style="display: block;" href="http://47.94.245.205/" title target="_blank">贴吧代签</a>
      
    </div>
  </div>

  
</aside>
      </div>
      <footer id="footer">
  <div class="foot-box global-width">
    &copy; 2019 竹子 &nbsp;&nbsp;
    驱动于 <a href="http://hexo.io/" target="_blank">Hexo</a>
    &nbsp;|&nbsp;主题 <a href="https://github.com/yiluyanxia/hexo-theme-antiquity">antiquity</a>
    <br>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">不蒜子告之   阁下是第<span id="busuanzi_value_site_pv"></span>个访客</span>
  </div>
</footer>
      <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
if (!window.jQuery) {
var script = document.createElement('script');
script.src = "/js/jquery-2.0.3.min.js";
document.body.write(script);
}
</script>

  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



    </div>
    <nav id="mobile-nav" class="mobile-nav-box">
  <div class="mobile-nav-img mobile-nav-top"></div>
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/categories" class="mobile-nav-link">分类</a>
  
    <a href="/tags" class="mobile-nav-link">标签</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
    <a href="/daiqian" class="mobile-nav-link">贴吧代签</a>
  
  <div class="mobile-nav-img  mobile-nav-bottom"></div>
</nav>    
  </div>
</body>
</html>